<!doctype html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>Ocena konia</title>
    <%- include("header") %>
</head>

<body>
    <script>
    $(function() {
        var competitionId = "<%- horseMark.competition._id %>";
        var juryId = "<%- horseMark.jury._id %>";
        var horseId = "<%- horseMark.horse._id %>";
        
        var socket = io.connect('//' + window.location.host, {secure: true});
        
        socket.emit("horseMarkByCompetitionIdAndJuryIdAndHorseIdReq", {
            competitionId: "<%- horseMark.competition._id %>",
            juryId: "<%- horseMark.jury._id %>",
            horseId: "<%- horseMark.horse._id %>"
        });
        
        setInterval(function() {
            socket.emit("horseMarkByCompetitionIdAndJuryIdAndHorseIdReq", {
                competitionId: "<%- horseMark.competition._id %>",
                juryId: "<%- horseMark.jury._id %>",
                horseId: "<%- horseMark.horse._id %>"
            });
        }, 5000);
        
        socket.on("horseMarkByCompetitionIdAndJuryIdAndHorseIdRes", function(data) {
            $("#type div").removeClass("active");
            var type = $("#type"+data.horseMark.type);
            type.addClass("active");
            
            $("#head div").removeClass("active");
            var head = $("#head"+data.horseMark.head);
            head.addClass("active");
            
            $("#body div").removeClass("active");
            var body = $("#body"+data.horseMark.body);
            body.addClass("active");
            
            $("#legs div").removeClass("active");
            var legs = $("#legs"+data.horseMark.legs);
            legs.addClass("active");
            
            $("#movement div").removeClass("active");
            var movement = $("#movement"+data.horseMark.movement);
            movement.addClass("active");
        });
        
        socket.on("changeMarkRes", function(data) {
            socket.emit("horseMarkByCompetitionIdAndJuryIdAndHorseIdReq", {
                competitionId: "<%- horseMark.competition._id %>",
                juryId: "<%- horseMark.jury._id %>",
                horseId: "<%- horseMark.horse._id %>"
            });
        });
        
        for (var i=1; i<21; i++) {
            var type = $("#type");
            var div = $("<div>").attr("id", "type"+i).addClass("box").val(i).text(i);
            div.click(function(e) {
                socket.emit("changeTypeMarkReq", {
                    competitionId: "<%- horseMark.competition._id %>",
                    juryId: "<%- horseMark.jury._id %>",
                    horseId: "<%- horseMark.horse._id %>",
                    type: $(this).val()
                });
            });
            type.append(div);
            
            if ( ($(document).width() <= 800) && (i==10)){
                type.append($("<br>"));
            }
            
            var head = $("#head");
            var div = $("<div>").attr("id", "head"+i).addClass("box").val(i).text(i);
            div.click(function(e) {
                socket.emit("changeHeadMarkReq", {
                    competitionId: "<%- horseMark.competition._id %>",
                    juryId: "<%- horseMark.jury._id %>",
                    horseId: "<%- horseMark.horse._id %>",
                    head: $(this).val()
                });
            });
            head.append(div);
            
               if ( ($(window).width() <= 800) && (i==10)){
                head.append($("<br>"));
            }
            var body = $("#body");
            var div = $("<div>").attr("id", "body"+i).addClass("box").val(i).text(i);
            div.click(function(e) {
                socket.emit("changeBodyMarkReq", {
                    competitionId: "<%- horseMark.competition._id %>",
                    juryId: "<%- horseMark.jury._id %>",
                    horseId: "<%- horseMark.horse._id %>",
                    body: $(this).val()
                });
            });
            body.append(div);
            
               if ( ($(window).width() <= 800) && (i==10)){
                body.append($("<br>"));
            }
            var legs = $("#legs");
            var div = $("<div>").attr("id", "legs"+i).addClass("box").val(i).text(i);
            div.click(function(e) {
                socket.emit("changeLegsMarkReq", {
                    competitionId: "<%- horseMark.competition._id %>",
                    juryId: "<%- horseMark.jury._id %>",
                    horseId: "<%- horseMark.horse._id %>",
                    legs: $(this).val()
                });
            });
            legs.append(div);
            
               if ( ($(window).width() <= 800) && (i==10)){
                legs.append($("<br>"));
            }
            var movement = $("#movement");
            var div = $("<div>").attr("id", "movement"+i).addClass("box").val(i).text(i);
            div.click(function(e) {
                socket.emit("changeMovementMarkReq", {
                    competitionId: "<%- horseMark.competition._id %>",
                    juryId: "<%- horseMark.jury._id %>",
                    horseId: "<%- horseMark.horse._id %>",
                    movement: $(this).val()
                });
            });
            movement.append(div);
            
              if ( ($(window).width() <= 800) && (i==10)){
                movement.append($("<br>"));
            }           
        }               
        setInterval(function() {
//            console.log("shouldIHurryUpReq");
            socket.emit("shouldIHurryUpReq", {
                competitionId: competitionId,
                juryId: juryId
            });
        }, 1000);
        
        socket.on("shouldIHurryUpRes", function(data) {
//            console.log("shouldIHurryUpRes")
            $("#message").text("Proszę się pośpieszyć!");
        });
    });
    </script>
    <div>
        <a href="/jury/competition/<%- horseMark.competition._id %>">Powrót do strony zawodów</a>
        <a href="/profile">Edycja profilu</a>
        <a href="/logout">Wyloguj</a>
    </div>
    <div id="message"></div>
    <h1>Ocena konia: <%- horseMark.horse.horseName %></h1>
    <div>
        <div id="type">
            <p>Typ</p>
        </div>
        <div id="head">
            <p>Głowa</p>
        </div>
        <div id="body">
            <p>Tułów</p>
        </div>
        <div id="legs">
            <p>Nogi</p>
        </div>
        <div id="movement">
            <p>Ruch</p>
        </div>
    </div>
</body>

</html>
